<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="initial-scale=1, maximum-scale=1"/>
  <title>Smart Farm AI Map</title>
  <style>
    html, body, #map { height: 100%; margin:0; }
    #tools { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 8px; border-radius: 8px; font-family: -apple-system, system-ui; }
    #done { position: absolute; bottom: 16px; left: 16px; right: 16px; padding: 14px; background: #22c55e; color: white; border-radius: 12px; text-align: center; font-weight: 700; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="tools">
    <button onclick="mode='marker'">Marker</button>
    <button onclick="mode='polygon'">Polygon</button>
    <button onclick="clearAll()">Clear</button>
    <div style="margin-top:6px; font-size:12px; color:#555;">Click to place markers, draw to outline your field</div>
  </div>
  <div id="done" onclick="sendState()">DONE</div>
  <script>
    // Simulated Google Maps using Leaflet-like minimal JS (no external CDN allowed); fallback to basic events
    let mode = 'marker';
    let markers = [];
    let polygon = [];
    const map = {
      center: {lat: 37.7749, lng: -122.4194}, zoom: 12
    };
    document.body.addEventListener('click', function(e){
      // Roughly map screen clicks to lat/lng offsets around center for demo
      const rect = document.body.getBoundingClientRect();
      const nx = (e.clientX - rect.width/2) / rect.width;
      const ny = (e.clientY - rect.height/2) / rect.height;
      const lat = map.center.lat + ny * 0.1;
      const lng = map.center.lng + nx * 0.1;
      if (mode === 'marker') { markers.push([lat,lng]); draw(); }
      if (mode === 'polygon') { polygon.push([lat,lng]); draw(); }
    });
    function draw(){
      // Simple visual feedback: draw SVG overlay
      let svg = document.getElementById('overlay');
      if(!svg){
        svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
        svg.setAttribute('id','overlay');
        svg.style.position='absolute'; svg.style.left=0; svg.style.top=0; svg.style.width='100%'; svg.style.height='100%';
        document.body.appendChild(svg);
      }
      svg.innerHTML='';
      const w = window.innerWidth, h = window.innerHeight;
      const toScreen = ([lat,lng])=>{
        const dx = (lng - map.center.lng)/0.1 * w/2 + w/2;
        const dy = (lat - map.center.lat)/0.1 * h/2 + h/2;
        return [dx,dy];
      };
      markers.forEach(m=>{
        const [x,y]=toScreen(m);
        const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
        c.setAttribute('cx',x); c.setAttribute('cy',y); c.setAttribute('r',6); c.setAttribute('fill','#16a34a');
        svg.appendChild(c);
      });
      if(polygon.length>1){
        const pts = polygon.map(p=>toScreen(p).join(',')).join(' ');
        const poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
        poly.setAttribute('points', pts);
        poly.setAttribute('fill', 'rgba(34,197,94,0.2)');
        poly.setAttribute('stroke', '#16a34a');
        poly.setAttribute('stroke-width', '2');
        svg.appendChild(poly);
      }
    }
    function clearAll(){ markers=[]; polygon=[]; draw(); }
    function sendState(){
      const payload = { markers, polygon };
      window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.mapBridge && window.webkit.messageHandlers.mapBridge.postMessage(JSON.stringify(payload));
    }
  </script>
</body>
</html>


